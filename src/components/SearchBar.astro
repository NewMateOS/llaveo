---
const { value = '', city = '', status = '', minRooms = '', minPrice = '', maxPrice = '' } = Astro.props;
---
<form class="w-full max-w-7xl mx-auto" on:submit|preventDefault={(e)=>{
  const formData = new FormData(e.target as HTMLFormElement);
  const p = new URLSearchParams();
  for (const [key, value] of formData.entries()) {
    p.append(key, value.toString());
  }
  window.location.href = '/resultados?'+p.toString();
}}>
  <!-- Main Search Container - Material Design Elevated Card -->
  <div class="bg-white rounded-2xl shadow-lg hover:shadow-xl transition-shadow duration-300 border border-gray-100 overflow-hidden card-hover">
    <!-- Search Input Row -->
    <div class="flex flex-col sm:flex-row sm:items-center gap-3 px-4 sm:px-6 py-3 sm:py-4">
      <!-- Search Icon -->
      <div class="flex-shrink-0 sm:mr-4 hidden sm:block">
        <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
        </svg>
      </div>
      
      <!-- Search Input -->
      <input
        class="w-full sm:flex-1 outline-none text-base sm:text-lg font-normal placeholder-gray-400 focus:placeholder-gray-300 transition-colors duration-200 border border-gray-200 rounded-lg px-4 py-3.5 sm:py-3 focus-ring"
        style="color: var(--text-primary);"
        type="search"
        name="q"
        placeholder="Buscar por calle, barrio o ciudad…"
        value={value}
        aria-label="Buscar viviendas"
        enterkeyhint="search"
        inputmode="search"
      />
      
      <!-- Search Button - Material Design Primary Button -->
      <button 
        type="submit"
        class="w-full sm:w-auto sm:ml-4 px-5 sm:px-6 py-3.5 sm:py-3 rounded-xl font-medium text-white shadow-sm hover:shadow-md transition-all duration-200 transform hover:scale-[1.02] active:scale-95 btn-primary focus-ring"
      >
        Buscar
      </button>
      
      <!-- Mobile Filters Toggle (visible solo en móvil) -->
      <button 
        type="button" 
        id="toggle-filters-btn-mobile"
        class="sm:hidden w-full px-4 py-3 rounded-lg text-sm font-medium border border-gray-200 hover:bg-gray-50 transition-colors duration-200 focus-ring"
        onclick="toggleFilters()"
        aria-controls="filters-container"
        aria-expanded="false"
      >
        Filtros
      </button>
    </div>
    
    <!-- Divider -->
    <div class="border-t border-gray-100"></div>
    
    <!-- Filters Section -->
    <div class="px-4 sm:px-6 py-4 bg-white">
      <div class="hidden sm:flex items-center justify-between mb-4">
        <h3 class="text-sm font-medium text-gray-700 uppercase tracking-wide">Filtros</h3>
        <button 
          type="button" 
          id="toggle-filters-btn"
          class="text-sm font-medium transition-colors duration-200 text-primary-600 hover:text-primary-700 rounded focus-ring"
        >
          <span id="toggle-text">Mostrar filtros</span>
          <svg id="toggle-icon" class="w-4 h-4 ml-1 inline transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
          </svg>
        </button>
      </div>
      
      <!-- Filters Grid - Initially Hidden -->
      <div id="filters-container" class="hidden grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-3 sm:gap-4">
        <!-- City Filter -->
        <div class="relative">
          <label class="block text-xs font-medium text-gray-600 mb-2 uppercase tracking-wide">Ciudad</label>
          <select name="city" class="w-full appearance-none bg-white border border-gray-200 rounded-lg px-4 py-3.5 text-base sm:text-sm font-normal text-gray-900 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-200 hover:border-gray-300 focus-ring">
            <option value="">Cualquier ciudad</option>
            <option value="Madrid">Madrid</option>
            <option value="Barcelona">Barcelona</option>
            <option value="Valencia">Valencia</option>
            <option value="Sevilla">Sevilla</option>
            <option value="Bilbao">Bilbao</option>
            <option value="Málaga">Málaga</option>
          </select>
          <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none top-6">
            <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
          </div>
        </div>
        
        <!-- Rooms Filter -->
        <div class="relative">
          <label class="block text-xs font-medium text-gray-600 mb-2 uppercase tracking-wide">Habitaciones</label>
          <select name="minRooms" class="w-full appearance-none bg-white border border-gray-200 rounded-lg px-4 py-3.5 text-base sm:text-sm font-normal text-gray-900 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-200 hover:border-gray-300 focus-ring">
            <option value="">Cualquier cantidad</option>
            <option value="1" selected={minRooms === '1'}>1+</option>
            <option value="2" selected={minRooms === '2'}>2+</option>
            <option value="3" selected={minRooms === '3'}>3+</option>
            <option value="4" selected={minRooms === '4'}>4+</option>
            <option value="5" selected={minRooms === '5'}>5+</option>
          </select>
          <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none top-6">
            <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
          </div>
        </div>
        
        <!-- Status Filter -->
        <div class="relative">
          <label class="block text-xs font-medium text-gray-600 mb-2 uppercase tracking-wide">Estado</label>
          <select name="status" class="w-full appearance-none bg-white border border-gray-200 rounded-lg px-4 py-3.5 text-base sm:text-sm font-normal text-gray-900 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-200 hover:border-gray-300 focus-ring">
            <option value="">Cualquier estado</option>
            <option value="venta" selected={status === 'venta'}>Venta</option>
            <option value="alquiler" selected={status === 'alquiler'}>Alquiler</option>
          </select>
          <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none top-6">
            <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
          </div>
        </div>
        
        <!-- Min Price Filter -->
        <div class="relative">
          <label class="block text-xs font-medium text-gray-600 mb-2 uppercase tracking-wide">Precio mínimo</label>
          <select name="minPrice" class="w-full appearance-none bg-white border border-gray-200 rounded-lg px-4 py-3.5 text-base sm:text-sm font-normal text-gray-900 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-200 hover:border-gray-300 focus-ring">
            <option value="">Sin mínimo</option>
            <option value="50000" selected={minPrice === '50000'}>50.000€</option>
            <option value="100000" selected={minPrice === '100000'}>100.000€</option>
            <option value="200000" selected={minPrice === '200000'}>200.000€</option>
            <option value="300000" selected={minPrice === '300000'}>300.000€</option>
            <option value="500000" selected={minPrice === '500000'}>500.000€</option>
          </select>
          <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none top-6">
            <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
          </div>
        </div>
        
        <!-- Max Price Filter -->
        <div class="relative">
          <label class="block text-xs font-medium text-gray-600 mb-2 uppercase tracking-wide">Precio máximo</label>
          <select name="maxPrice" class="w-full appearance-none bg-white border border-gray-200 rounded-lg px-4 py-3.5 text-base sm:text-sm font-normal text-gray-900 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-200 hover:border-gray-300 focus-ring">
            <option value="">Sin máximo</option>
            <option value="200000" selected={maxPrice === '200000'}>200.000€</option>
            <option value="300000" selected={maxPrice === '300000'}>300.000€</option>
            <option value="500000" selected={maxPrice === '500000'}>500.000€</option>
            <option value="750000" selected={maxPrice === '750000'}>750.000€</option>
            <option value="1000000" selected={maxPrice === '1000000'}>1.000.000€</option>
          </select>
          <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none top-6">
            <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
          </div>
        </div>
      </div>
    </div>
  </div>
</form>

<script>
  // Función para toggle de filtros
  function toggleFilters() {
    const container = document.getElementById('filters-container');
    const toggleText = document.getElementById('toggle-text');
    const toggleIcon = document.getElementById('toggle-icon');
    
    if (!container || !toggleText || !toggleIcon) return;
    
    if (container.classList.contains('hidden')) {
      container.classList.remove('hidden');
      toggleText.textContent = 'Ocultar filtros';
      toggleIcon.style.transform = 'rotate(180deg)';
    } else {
      container.classList.add('hidden');
      toggleText.textContent = 'Mostrar filtros';
      toggleIcon.style.transform = 'rotate(0deg)';
    }
  }

  // Hacer la función disponible globalmente para compatibilidad
  (window as any).toggleFilters = toggleFilters;

  // Agregar event listener cuando el DOM esté listo
  function setupToggleFilters() {
    const toggleBtn = document.getElementById('toggle-filters-btn');
    if (toggleBtn) {
      // Remover listener previo si existe
      toggleBtn.removeEventListener('click', toggleFilters);
      // Agregar nuevo listener
      toggleBtn.addEventListener('click', toggleFilters);
    }
  }

  // Ejecutar cuando el DOM esté listo
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', setupToggleFilters);
  } else {
    // DOM ya está cargado
    setupToggleFilters();
  }
</script>
