---
// P√°gina de configuraci√≥n de seguridad para producci√≥n
export const prerender = false;

const nonce = Astro.locals.cspNonce || 'dynamic-nonce';

const securityConfig = {
  headers: {
    'Content-Security-Policy': `default-src 'self'; script-src 'self' 'nonce-${nonce}' https://cdn.jsdelivr.net https://unpkg.com; style-src 'self' 'nonce-${nonce}' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https: blob:; connect-src 'self' https://*.supabase.co wss://*.supabase.co; frame-src 'none'; object-src 'none'; base-uri 'self'; form-action 'self'; frame-ancestors 'none'`,
    'X-Frame-Options': 'DENY',
    'X-Content-Type-Options': 'nosniff',
    'Referrer-Policy': 'strict-origin-when-cross-origin',
    'Permissions-Policy': 'camera=(), microphone=(), geolocation=(), interest-cohort=()',
    'Strict-Transport-Security': 'max-age=31536000; includeSubDomains; preload'
  },
  environment: {
    nodeEnv: import.meta.env.MODE,
    isProduction: import.meta.env.PROD,
    isDevelopment: import.meta.env.DEV
  },
  supabase: {
    url: import.meta.env.PUBLIC_SUPABASE_URL ? 'Configurado' : 'No configurado',
    anonKey: import.meta.env.PUBLIC_SUPABASE_ANON_KEY ? 'Configurado' : 'No configurado'
  }
};
---

<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Configuraci√≥n de Seguridad ¬∑ LLaveo</title>
    <style nonce={Astro.locals.cspNonce}>
      body {
        font-family: system-ui, -apple-system, sans-serif;
        line-height: 1.6;
        color: #333;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background: #f5f5f5;
      }
      .container {
        background: white;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      }
      .status {
        display: inline-block;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: bold;
        text-transform: uppercase;
      }
      .status.ok { background: #d4edda; color: #155724; }
      .status.warning { background: #fff3cd; color: #856404; }
      .status.error { background: #f8d7da; color: #721c24; }
      .section {
        margin-bottom: 30px;
        padding: 20px;
        border: 1px solid #e0e0e0;
        border-radius: 6px;
      }
      .section h2 {
        margin-top: 0;
        color: #2c3e50;
        border-bottom: 2px solid #3498db;
        padding-bottom: 10px;
      }
      .config-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 0;
        border-bottom: 1px solid #f0f0f0;
      }
      .config-item:last-child {
        border-bottom: none;
      }
      .config-key {
        font-weight: 500;
        color: #555;
      }
      .config-value {
        font-family: monospace;
        background: #f8f9fa;
        padding: 2px 6px;
        border-radius: 3px;
        font-size: 12px;
      }
      .recommendations {
        background: #e8f4fd;
        border-left: 4px solid #3498db;
        padding: 15px;
        margin: 20px 0;
      }
      .recommendations h3 {
        margin-top: 0;
        color: #2c3e50;
      }
      .recommendations ul {
        margin: 10px 0;
        padding-left: 20px;
      }
      .recommendations li {
        margin: 5px 0;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üîí Configuraci√≥n de Seguridad - LLaveo</h1>
      
      <div class="recommendations">
        <h3>‚ö†Ô∏è Configuraci√≥n Requerida para Producci√≥n</h3>
        <ul>
          <li>Configurar variables de entorno de Supabase</li>
          <li>Habilitar HTTPS en producci√≥n</li>
          <li>Configurar rate limiting con Redis u otro almac√©n compartido</li>
          <li>Implementar logging y monitoreo de seguridad</li>
          <li>Configurar monitoreo de errores</li>
        </ul>
      </div>

      <div class="section">
        <h2>üåê Headers de Seguridad</h2>
        {Object.entries(securityConfig.headers).map(([key, value]) => (
          <div class="config-item">
            <span class="config-key">{key}</span>
            <span class="config-value">{value}</span>
          </div>
        ))}
      </div>

      <div class="section">
        <h2>üîß Variables de Entorno</h2>
        <div class="config-item">
          <span class="config-key">Entorno</span>
          <span class="status {securityConfig.environment.isProduction ? 'ok' : 'warning'}">
            {securityConfig.environment.nodeEnv}
          </span>
        </div>
        <div class="config-item">
          <span class="config-key">Supabase URL</span>
          <span class="status {securityConfig.supabase.url === 'Configurado' ? 'ok' : 'error'}">
            {securityConfig.supabase.url}
          </span>
        </div>
        <div class="config-item">
          <span class="config-key">Supabase Anon Key</span>
          <span class="status {securityConfig.supabase.anonKey === 'Configurado' ? 'ok' : 'error'}">
            {securityConfig.supabase.anonKey}
          </span>
        </div>
      </div>

      <div class="section">
        <h2>üõ°Ô∏è Medidas de Seguridad Implementadas</h2>
        <ul>
          <li>‚úÖ Validaci√≥n de entrada en las APIs</li>
          <li>‚úÖ Rate limiting b√°sico en memoria</li>
          <li>‚úÖ Headers de seguridad con CSP basado en nonce</li>
          <li>‚úÖ Sanitizaci√≥n de datos en formularios</li>
          <li>‚úÖ Validaci√≥n de roles de usuario</li>
          <li>‚ö†Ô∏è Pendiente implementar protecci√≥n CSRF</li>
          <li>‚ö†Ô∏è Pendiente habilitar logging/monitorizaci√≥n centralizados</li>
        </ul>
      </div>

      <div class="section">
        <h2>üìã Checklist de Producci√≥n</h2>
        <ul>
          <li>‚ñ° Configurar variables de entorno reales</li>
          <li>‚ñ° Habilitar HTTPS</li>
          <li>‚ñ° Configurar dominio permitido para Google OAuth</li>
          <li>‚ñ° Implementar Redis para rate limiting</li>
          <li>‚ñ° Configurar monitoreo (Sentry, etc.)</li>
          <li>‚ñ° Configurar backup de base de datos</li>
          <li>‚ñ° Implementar logging de auditor√≠a</li>
          <li>‚ñ° Configurar alertas de seguridad</li>
        </ul>
      </div>
    </div>
  </body>
</html>
