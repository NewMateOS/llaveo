---
import { getSupabaseServerClient } from '../lib/supabase-server';

const supabaseServer = getSupabaseServerClient(Astro.cookies);
const { data: { session } } = await supabaseServer.auth.getSession();
const isLoggedIn = !!session?.user;
const brand = import.meta.env.PUBLIC_BRAND_NAME || 'LLAVE';
---

<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Acceso Denegado · {brand}</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="description" content="No tienes permisos para acceder a esta página" />
  </head>
  <body class="min-h-screen bg-gray-50">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b border-gray-100">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-16">
          <div class="flex items-center">
            <a href="/" class="flex items-center space-x-3">
              <div class="w-10 h-10 rounded-xl flex items-center justify-center shadow-sm bg-token-primary-gradient">
                <span class="text-white font-bold text-lg">L</span>
              </div>
              <span class="text-xl font-bold text-token-primary">{brand}</span>
            </a>
          </div>
          
          <nav class="flex items-center space-x-4">
            <a href="/" class="px-4 py-2 rounded-lg text-sm font-medium transition-colors duration-200 hover:bg-gray-100 text-token-secondary">
              Inicio
            </a>
            <a href="/resultados" class="px-4 py-2 rounded-lg text-sm font-medium transition-colors duration-200 hover:bg-gray-100 text-token-secondary">
              Propiedades
            </a>
            {isLoggedIn ? (
              <a href="/admin" class="px-4 py-2 rounded-lg text-sm font-medium text-white shadow-sm hover:shadow-md transition-all duration-200 bg-token-primary-gradient">
                Admin
              </a>
            ) : null}
          </nav>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
      <div class="text-center">
        <div class="w-24 h-24 rounded-2xl flex items-center justify-center mx-auto mb-8 shadow-lg bg-red-50">
          <svg class="w-12 h-12 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
          </svg>
        </div>

        <h1 class="text-4xl font-bold mb-4 text-token-primary">
          Acceso Denegado
        </h1>

        <p class="text-xl text-gray-600 mb-8 max-w-2xl mx-auto">
          No tienes permisos para acceder a esta página. Contacta con un administrador si crees que esto es un error.
        </p>

        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <a 
            href="/" 
            class="px-8 py-3 rounded-xl font-medium text-white shadow-sm hover:shadow-md transition-all duration-200 transform hover:scale-105 active:scale-95 bg-token-primary-gradient"
          >
            Volver al Inicio
          </a>
          
          {isLoggedIn ? (
            <a 
              href="/admin" 
              class="px-8 py-3 rounded-xl font-medium border border-gray-200 text-gray-700 hover:bg-gray-50 transition-all duration-200"
            >
              Panel de Admin
            </a>
          ) : null}
        </div>

        <div class="mt-12 p-6 bg-white rounded-2xl shadow-sm border border-gray-100 max-w-2xl mx-auto">
          <h3 class="text-lg font-semibold mb-4 text-token-primary">
            ¿Por qué veo esta página?
          </h3>
          <div class="text-left space-y-3 text-gray-600">
            <div class="flex items-start space-x-3">
              <div class="w-2 h-2 rounded-full bg-red-500 mt-2 flex-shrink-0"></div>
              <p>No tienes una sesión activa o tu sesión ha expirado</p>
            </div>
            <div class="flex items-start space-x-3">
              <div class="w-2 h-2 rounded-full bg-red-500 mt-2 flex-shrink-0"></div>
              <p>Tu cuenta no tiene los permisos necesarios para acceder a esta sección</p>
            </div>
            <div class="flex items-start space-x-3">
              <div class="w-2 h-2 rounded-full bg-red-500 mt-2 flex-shrink-0"></div>
              <p>Estás intentando acceder a una página que requiere autenticación de administrador</p>
            </div>
          </div>
        </div>
      </div>
    </main>

    <footer class="bg-white border-t border-gray-100 mt-16">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="text-center text-gray-500 text-sm">
          <p>&copy; 2024 {brand}. Todos los derechos reservados.</p>
        </div>
      </div>
    </footer>
  </body>
</html>
