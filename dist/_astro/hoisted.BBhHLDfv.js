import{g}from"./supabase-client.DOekNLRN.js";import{h as i}from"./session-sync.BLQ7z1dq.js";import"./index.9QnQ_JI4.js";import"./_commonjsHelpers.C4iS2aBk.js";const t=g();window.hydrateSupabaseSession||(window.hydrateSupabaseSession=()=>i(t));(async()=>{const{data:{session:e}}=await t.auth.getSession();if(e){console.log("🔄 [AccessDenied] Sesión encontrada en cliente, intentando sincronizar...");try{const o=await fetch("/api/auth/session",{method:"POST",headers:{"content-type":"application/json"},credentials:"same-origin",body:JSON.stringify({session:{access_token:e.access_token,refresh_token:e.refresh_token}})});o.ok?(console.log("✅ [AccessDenied] Sesión sincronizada, esperando un momento antes de redirigir..."),await new Promise(r=>setTimeout(r,1e3)),window.location.href="/admin?synced=true"):console.error("❌ [AccessDenied] Error al sincronizar sesión:",await o.text())}catch(o){console.error("❌ [AccessDenied] Error:",o)}}i(t)})();const n=document.getElementById("auth-modal"),c=document.getElementById("auth-form"),s=document.getElementById("auth-message"),w=document.getElementById("close-auth-modal"),f=document.getElementById("google-auth-btn");function p(){n.classList.remove("hidden"),n.classList.add("flex")}function d(){n.classList.add("hidden"),n.classList.remove("flex"),c.reset(),m()}function h(e,o="error"){s.textContent=e,s.className=`mt-4 p-3 rounded-lg ${o==="error"?"bg-red-50 text-red-700 border border-red-200":"bg-green-50 text-green-700 border border-green-200"}`,s.classList.remove("hidden")}function m(){s.classList.add("hidden")}async function y(e){if(!(!e?.access_token||!e?.refresh_token))try{const o=await fetch("/api/auth/session",{method:"POST",headers:{"content-type":"application/json"},credentials:"same-origin",body:JSON.stringify({session:{access_token:e.access_token,refresh_token:e.refresh_token}})});o.ok||console.error("No se pudo sincronizar la sesión con el servidor",await o.text())}catch(o){console.error("Error al sincronizar sesión con el servidor",o)}}async function k(e){e.preventDefault(),m();const o=new FormData(c),r=o.get("email"),u=o.get("password");try{const{data:a,error:l}=await t.auth.signInWithPassword({email:r,password:u});if(l)throw l;await y(a?.session),await i(t),window.location.href="/admin"}catch(a){h(a.message||"Error en la autenticación")}}async function S(){try{const{error:e}=await t.auth.signInWithOAuth({provider:"google",options:{redirectTo:`${window.location.origin}/auth/callback?redirect=/admin`}});if(e)throw e}catch(e){h(e.message||"Error con Google OAuth")}}w?.addEventListener("click",d);c?.addEventListener("submit",k);f?.addEventListener("click",S);n?.addEventListener("click",e=>{e.target===n&&d()});window.showLoginModal=p;window.hideAuthModal=d;
