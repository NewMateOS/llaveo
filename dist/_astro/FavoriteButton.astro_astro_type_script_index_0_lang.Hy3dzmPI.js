import{g as v}from"./supabase-client.DOekNLRN.js";let n=new Map;const w=v();async function c(){try{const{data:{session:o},error:e}=await w.auth.getSession();return e?(console.error("❌ [FavoriteButton] Error obteniendo sesión:",e),null):o?.access_token||null}catch(o){return console.error("❌ [FavoriteButton] Error obteniendo token:",o),null}}async function y(o){const e=await c();if(!e){window.showLoginModal?window.showLoginModal():alert("Debes iniciar sesión para agregar favoritos");return}const t=document.getElementById(`favorite-btn-${o}`);if(t){t.disabled=!0,t.style.opacity="0.6";try{const f=n.get(o)||!1?"remove":"add",i=await fetch("/api/favorites",{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({property_id:o,action:f})});if(i.ok){const{isFavorite:a,message:g}=await i.json();n.set(o,a),l(o,a),s(g,"success"),window.onFavoriteToggle&&window.onFavoriteToggle(o,a)}else{const{error:a}=await i.json();s(a,"error")}}catch(r){console.error("Error toggling favorite:",r),s("Error al actualizar favoritos","error")}finally{t.disabled=!1,t.style.opacity="1"}}}function l(o,e){const t=document.getElementById(`favorite-btn-${o}`);if(!t)return;t.setAttribute("data-is-favorite",e),t.title=e?"Quitar de favoritos":"Agregar a favoritos",t.style.background=e?"var(--primary)":"transparent",t.style.color=e?"white":"var(--primary)";const r=t.querySelector("svg");r&&r.setAttribute("fill",e?"currentColor":"none")}function s(o,e){const t=document.createElement("div");t.className=`fixed top-4 right-4 z-50 px-4 py-2 rounded-lg shadow-lg transition-all duration-300 transform translate-x-full ${e==="success"?"bg-green-500 text-white":"bg-red-500 text-white"}`,t.textContent=o,document.body.appendChild(t),setTimeout(()=>{t.style.transform="translateX(0)"},100),setTimeout(()=>{t.style.transform="translateX(100%)",setTimeout(()=>{document.body.removeChild(t)},300)},3e3)}async function u(){const o=await c();if(o)try{const e=await fetch("/api/favorites",{headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"}});if(e.ok){const{favorites:t}=await e.json();t.forEach(r=>{n.set(r.property_id,!0),l(r.property_id,!0)})}}catch(e){console.error("Error loading favorites:",e)}}function d(){document.querySelectorAll(".favorite-btn").forEach(e=>{const t=e.getAttribute("data-property-id"),r=e.getAttribute("data-is-favorite")==="true";n.set(t,r)})}window.toggleFavorite=y;window.loadFavoritesState=u;window.initializeFavorites=d;document.addEventListener("DOMContentLoaded",()=>{d(),u()});
